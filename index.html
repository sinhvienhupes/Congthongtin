<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HUPES Sinh Viên QPAN</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* --- 1. CẤU HÌNH --- */
        :root {
            --primary: #0056b3;
            --primary-bg: #eef6ff;
            --accent: #f59e0b;
            --bg-body: #f3f4f6;
            --white: #ffffff;
            --text-main: #1f2937;
            --app-width: 460px;
            --header-height: 65px;
            --nav-height: 70px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            background-color: #e5e7eb;
            height: 100vh;
            display: flex; justify-content: center;
            overflow: hidden;
        }

        #app-shell {
            width: 100%; max-width: var(--app-width);
            background: var(--bg-body);
            height: 100%;
            display: flex; flex-direction: column;
            position: relative;
            box-shadow: 0 0 40px rgba(0,0,0,0.1);
        }

        /* --- 2. HEADER --- */
        .app-header {
            flex: 0 0 var(--header-height);
            background: var(--white);
            padding: 0 15px;
            display: flex; 
            justify-content: flex-start; 
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            z-index: 50;
        }
        
        .logo-img { height: 45px; width: auto; object-fit: contain; border-radius: 50%; }
        .brand { text-align: left; }
        .brand h1 { font-size: 1.2rem; font-weight: 800; color: var(--primary); margin: 0; line-height: 1.1; }
        .brand p { font-size: 0.7rem; color: #6b7280; font-weight: 600; text-transform: uppercase; margin-top: 2px; }

        /* --- 3. MARQUEE --- */
        .ticker-wrap {
            flex: 0 0 32px;
            background: #fff7ed; border-bottom: 1px solid #fed7aa;
            overflow: hidden; display: flex; align-items: center;
        }
        .ticker {
            white-space: nowrap; animation: ticker 25s linear infinite;
            font-size: 0.8rem; color: #c2410c; font-weight: 600; padding-left: 100%;
        }
        @keyframes ticker { 100% { transform: translateX(-100%); } }

        /* --- 4. NỘI DUNG --- */
        .scroll-container {
            flex: 1; overflow-y: auto;
            scrollbar-width: none; 
            position: relative;
        }
        .scroll-container::-webkit-scrollbar { display: none; }
        .content-padding { padding: 15px; }

        /* --- TAB 1: TRANG CHỦ --- */
        .banner-card {
            background: linear-gradient(135deg, #0056b3, #003d80);
            border-radius: 16px; padding: 25px 20px; color: white; margin-bottom: 20px;
            box-shadow: 0 8px 16px rgba(0, 86, 179, 0.2); position: relative; overflow: hidden;
        }
        .banner-card::after {
            content: ''; position: absolute; top: -30px; right: -30px; width: 120px; height: 120px;
            background: rgba(255,255,255,0.1); border-radius: 50%;
        }
        
        /* Grid Menu */
        .grid-menu { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; margin-bottom: 25px; }
        .menu-item {
            background: white; border-radius: 12px; padding: 15px;
            display: flex; flex-direction: column; align-items: center; gap: 8px; text-align: center;
            text-decoration: none; color: var(--text-main);
            box-shadow: 0 1px 3px rgba(0,0,0,0.03); transition: 0.2s;
        }
        .menu-item:active { transform: scale(0.97); background: #fafafa; }
        
        .icon-box { width: 45px; height: 45px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; }
        .ic-edu { background: #e0f2fe; color: #0284c7; }
        .ic-web { background: #fff7ed; color: #f59e0b; }
        .ic-fb { background: #eff6ff; color: #1877f2; }
        .ic-doan { background: #fee2e2; color: #dc2626; } /* Màu đỏ cho Đoàn */
        .ic-contact { background: #f0fdf4; color: #16a34a; }

        /* News Section */
        .news-list { display: flex; flex-direction: column; gap: 12px; }
        .news-card {
            background: white; border-radius: 12px; padding: 15px;
            display: flex; gap: 12px; align-items: flex-start;
            box-shadow: 0 1px 2px rgba(0,0,0,0.03); cursor: pointer; transition: 0.2s;
            border-left: 4px solid transparent;
        }
        .news-card:hover { transform: translateY(-2px); }
        .news-card.highlight { border-left-color: var(--accent); }
        
        .news-icon {
            width: 40px; height: 40px; border-radius: 8px; background: #f3f4f6;
            display: flex; align-items: center; justify-content: center; font-size: 1.2rem; color: #6b7280; flex-shrink: 0;
        }
        .news-content h4 { font-size: 0.9rem; font-weight: 700; margin-bottom: 4px; line-height: 1.3; }
        .news-content p { font-size: 0.75rem; color: #6b7280; margin: 0; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .news-date { font-size: 0.7rem; color: var(--primary); font-weight: 600; margin-top: 6px; }

        /* --- TAB 2: TÍNH ĐIỂM --- */
        .gpa-sticky-header {
            position: sticky; top: 0; z-index: 10;
            background: white; margin: 0; padding: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            border-bottom: 1px solid #f3f4f6;
            text-align: center;
        }
        .gpa-num { font-size: 3rem; font-weight: 800; color: var(--primary); line-height: 1; }
        .gpa-rank { 
            display: inline-block; background: #e0f2fe; color: #0284c7; 
            padding: 4px 12px; border-radius: 20px; font-weight: 700; font-size: 0.8rem; margin-top: 5px;
        }

        .subject-list-container { padding: 15px; padding-bottom: 80px; }
        .subject-item {
            background: white; border-radius: 12px; padding: 10px; margin-bottom: 10px;
            display: grid; grid-template-columns: 1fr 50px 90px 30px; gap: 8px; align-items: center;
            box-shadow: 0 1px 2px rgba(0,0,0,0.03); border: 1px solid #f1f5f9;
        }

        .inp-name { width: 100%; border: none; font-size: 0.9rem; font-weight: 600; color: #374151; background: transparent; }
        .inp-num { width: 100%; text-align: center; border: 1px solid #e5e7eb; border-radius: 8px; padding: 8px 0; font-weight: 600; background: #f9fafb; }
        .inp-sel { width: 100%; border: 1px solid #e5e7eb; border-radius: 8px; padding: 7px; background: #fff; font-size: 0.85rem; }
        .btn-x { width: 30px; height: 30px; background: #fee2e2; color: #ef4444; border: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; }

        .btn-add {
            width: 100%; padding: 12px; border: 2px dashed #cbd5e1; border-radius: 12px;
            background: transparent; color: #64748b; font-weight: 600; cursor: pointer;
        }

        /* --- TAB 3: LỊCH TUẦN --- */
        .iframe-container {
            width: 100%; height: 100%; display: flex; flex-direction: column; background: white;
        }
        .iframe-header {
            padding: 8px; text-align: center; font-size: 0.75rem; color: #9ca3af;
            background: #f9fafb; border-bottom: 1px solid #e5e7eb;
        }
        iframe { flex: 1; width: 100%; border: none; display: block; }

        /* --- 5. MENU ĐÁY --- */
        .bottom-nav {
            flex: 0 0 var(--nav-height);
            background: var(--white);
            border-top: 1px solid #e5e7eb;
            display: flex; justify-content: space-around; align-items: center;
            z-index: 100;
        }
        .nav-btn {
            background: none; border: none;
            display: flex; flex-direction: column; align-items: center; gap: 4px;
            color: #9ca3af; font-size: 0.7rem; font-weight: 600;
            width: 100%; height: 100%; justify-content: center; cursor: pointer;
        }
        .nav-btn i { font-size: 1.4rem; margin-bottom: 2px; transition: 0.2s; }
        .nav-btn.active { color: var(--primary); }
        .nav-btn.active i { transform: translateY(-3px); }

        .hidden { display: none !important; }
        .section-title { font-size: 0.95rem; font-weight: 700; margin-bottom: 12px; color: #111827; }
    </style>
</head>
<body>

    <div id="app-shell">
        
        <!-- HEADER -->
        <header class="app-header">
            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQacJpSk9xLyd6NarFg3cNld5iDBAcUjuPtsgOXR9fj6A&s=10" alt="Logo HUPES" class="logo-img">
            <div class="brand">
                <h1>HUPES</h1>
                <p>Cổng thông tin sinh viên</p>
            </div>
        </header>

        <!-- CHỮ CHẠY -->
        <div class="ticker-wrap">
            <div class="ticker">
                <i class="fas fa-bullhorn"></i> Web được làm bởi sinh viên QPAN để tra cứu thông tin nhanh nhất từ nhà trường và học tập.
            </div>
        </div>

        <!-- NỘI DUNG CUỘN -->
        <div class="scroll-container">
            
            <!-- TAB 1: TRANG CHỦ -->
            <div id="view-home" class="content-padding">
                <div class="banner-card">
                    <h2 style="font-size: 1.2rem; margin-bottom: 5px;">Xin chào!</h2>
                    <p style="font-size: 0.9rem; opacity: 0.9;">Chúc bạn một ngày học tập và rèn luyện hiệu quả.</p>
                </div>

                <!-- PHẦN 1: TIỆN ÍCH -->
                <div class="section-title">Tiện ích nhanh</div>
                <div class="grid-menu">
                    <a href="https://congthongtin.hupes.edu.vn/" target="_blank" class="menu-item">
                        <div class="icon-box ic-edu"><i class="fas fa-graduation-cap"></i></div>
                        <span>Tra điểm</span>
                    </a>
                    <a href="https://hupes.edu.vn/" target="_blank" class="menu-item">
                        <div class="icon-box ic-web"><i class="fas fa-globe"></i></div>
                        <span>Trang chủ</span>
                    </a>
                    <a href="https://www.facebook.com/share/1GF7xsuzyV/?mibextid=wwXIfr" target="_blank" class="menu-item">
                        <div class="icon-box ic-fb"><i class="fab fa-facebook-f"></i></div>
                        <span>FB Trường</span>
                    </a>
                    <!-- Nút Đoàn Thanh Niên Mới -->
                    <a href="https://www.facebook.com/share/19vPkeHYrn/?mibextid=wwXIfr" target="_blank" class="menu-item">
                        <div class="icon-box ic-doan"><i class="fas fa-users"></i></div>
                        <span>Đoàn TN</span>
                    </a>
                    <a href="#" onclick="switchTab('view-schedule', document.getElementById('btn-schedule'))" class="menu-item">
                        <div class="icon-box ic-contact"><i class="fas fa-calendar-alt"></i></div>
                        <span>Lịch tuần</span>
                    </a>
                     <a href="https://hupes.edu.vn/lien-he.html" target="_blank" class="menu-item">
                        <div class="icon-box ic-contact"><i class="fas fa-map-marked-alt"></i></div>
                        <span>Liên hệ</span>
                    </a>
                </div>

                <!-- PHẦN 2: TIN TỨC (MỚI) -->
                <div class="section-title">Tin tức & Sự kiện</div>
                <div class="news-list">
                    <!-- Tin 1: Lịch tuần -->
                    <div class="news-card highlight" onclick="switchTab('view-schedule', document.getElementById('btn-schedule'))">
                        <div class="news-icon"><i class="fas fa-calendar-week" style="color: var(--accent);"></i></div>
                        <div class="news-content">
                            <h4>Lịch công tác tuần mới nhất</h4>
                            <p>Xem chi tiết lịch học tập, giảng dạy và các hoạt động trong tuần của nhà trường.</p>
                            <div class="news-date">Cập nhật hàng tuần</div>
                        </div>
                    </div>

                    <!-- Tin 2: Đoàn TN -->
                    <a href="https://www.facebook.com/share/19vPkeHYrn/?mibextid=wwXIfr" target="_blank" class="news-card" style="text-decoration: none; color: inherit;">
                        <div class="news-icon"><i class="fab fa-facebook" style="color: #1877f2;"></i></div>
                        <div class="news-content">
                            <h4>Hoạt động Đoàn Thanh Niên</h4>
                            <p>Cập nhật các phong trào, hoạt động tình nguyện và sự kiện mới nhất từ Đoàn trường.</p>
                            <div class="news-date">Xem trên Facebook</div>
                        </div>
                    </a>

                    <!-- Tin 3: Thông báo chung -->
                    <a href="https://hupes.edu.vn/" target="_blank" class="news-card" style="text-decoration: none; color: inherit;">
                        <div class="news-icon"><i class="fas fa-bullhorn" style="color: var(--primary);"></i></div>
                        <div class="news-content">
                            <h4>Thông báo từ Nhà trường</h4>
                            <p>Các thông báo về học phí, quy chế đào tạo và các văn bản quan trọng khác.</p>
                            <div class="news-date">Xem trên Website</div>
                        </div>
                    </a>
                </div>
            </div>

            <!-- TAB 2: TÍNH ĐIỂM -->
            <div id="view-calc" class="hidden">
                <div class="gpa-sticky-header">
                    <div class="gpa-num" id="gpa-display">0.00</div>
                    <div style="font-size: 0.8rem; color: #6b7280; margin-top: 5px;">
                        Dựa trên <span id="tc-display" style="font-weight: 700; color: #374151;">0</span> tín chỉ
                    </div>
                    <div class="gpa-rank" id="rank-display">---</div>
                </div>

                <div class="subject-list-container">
                    <div id="list-container"></div>
                    
                    <button class="btn-add" onclick="addRow()"><i class="fas fa-plus"></i> Thêm môn</button>
                    
                    <button onclick="resetData()" style="width: 100%; margin-top: 20px; border: none; background: none; color: #ef4444; font-weight: 600; cursor: pointer;">
                        <i class="fas fa-trash"></i> Xóa tất cả
                    </button>
                </div>
            </div>

            <!-- TAB 3: LỊCH TUẦN -->
            <div id="view-schedule" class="hidden" style="height: 100%;">
                <div class="iframe-container">
                    <div class="iframe-header">
                        Đang tải dữ liệu từ hupes.edu.vn... | <a href="https://hupes.edu.vn/danh-muc-tin/lich-tuan.html" target="_blank" style="color: var(--primary); text-decoration: none;">Mở bằng trình duyệt</a>
                    </div>
                    <iframe src="https://hupes.edu.vn/danh-muc-tin/lich-tuan.html"></iframe>
                </div>
            </div>

        </div>

        <!-- MENU ĐÁY -->
        <nav class="bottom-nav">
            <button class="nav-btn active" onclick="switchTab('view-home', this)">
                <i class="fas fa-home"></i>
                <span>Trang chủ</span>
            </button>
            <button class="nav-btn" onclick="switchTab('view-calc', this)">
                <i class="fas fa-calculator"></i>
                <span>Tính điểm</span>
            </button>
            <button class="nav-btn" id="btn-schedule" onclick="switchTab('view-schedule', this)">
                <i class="fas fa-calendar-week"></i>
                <span>Lịch tuần</span>
            </button>
        </nav>

    </div>

    <!-- JS -->
    <script>
        const grades = [
            {t:'A (8.5-10)', v:4.0}, {t:'B+ (8.0-8.4)', v:3.5},
            {t:'B (7.0-7.9)', v:3.0}, {t:'C+ (6.5-6.9)', v:2.5},
            {t:'C (5.5-6.4)', v:2.0}, {t:'D+ (5.0-5.4)', v:1.5},
            {t:'D (4.0-4.9)', v:1.0}, {t:'F (<4.0)', v:0.0}
        ];

        window.onload = function() {
            const data = localStorage.getItem('hupes_qpan_final_v4');
            if(data) {
                try {
                    const parsed = JSON.parse(data);
                    if(parsed.length > 0) parsed.forEach(i => addRow(i.n, i.c, i.g));
                    else { addRow(); addRow(); }
                } catch(e) { addRow(); addRow(); }
            } else { addRow(); addRow(); }
            calc();
        };

        function switchTab(viewId, btn) {
            ['view-home', 'view-calc', 'view-schedule'].forEach(id => document.getElementById(id).classList.add('hidden'));
            document.getElementById(viewId).classList.remove('hidden');
            
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        // TÍNH ĐIỂM
        function addRow(n='', c=2, g=4.0) {
            const container = document.getElementById('list-container');
            const div = document.createElement('div');
            div.className = 'subject-item';
            
            const opts = grades.map(x => `<option value="${x.v}" ${x.v==g?'selected':''}>${x.t}</option>`).join('');

            div.innerHTML = `
                <input type="text" class="inp-name" placeholder="Môn..." value="${n}" oninput="calc()">
                <input type="number" class="inp-num" value="${c}" oninput="calc()" min="1" max="20">
                <select class="inp-sel" onchange="calc()">${opts}</select>
                <button class="btn-x" onclick="delRow(this)"><i class="fas fa-times"></i></button>
            `;
            container.appendChild(div);
            calc();
        }

        function delRow(btn) { btn.closest('.subject-item').remove(); calc(); }
        
        function resetData() {
            if(confirm('Xóa hết dữ liệu?')) {
                document.getElementById('list-container').innerHTML = '';
                localStorage.removeItem('hupes_qpan_final_v4');
                document.getElementById('gpa-display').innerText = "0.00";
                document.getElementById('tc-display').innerText = "0";
                document.getElementById('rank-display').innerText = "---";
                addRow(); addRow();
            }
        }

        function calc() {
            const rows = document.querySelectorAll('.subject-item');
            let tC=0, tP=0, data=[];
            rows.forEach(r => {
                const n=r.querySelector('.inp-name').value;
                const c=parseFloat(r.querySelector('.inp-num').value)||0;
                const g=parseFloat(r.querySelector('.inp-sel').value);
                data.push({n,c,g});
                if(c>0) { tC+=c; tP+=c*g; }
            });
            localStorage.setItem('hupes_qpan_final_v4', JSON.stringify(data));
            
            document.getElementById('tc-display').innerText = tC;
            if(tC===0) {
                document.getElementById('gpa-display').innerText = "0.00";
                document.getElementById('rank-display').innerText = "---";
                return;
            }
            const gpa = (tP/tC).toFixed(2);
            let rank = gpa>=3.6?"Xuất sắc":gpa>=3.2?"Giỏi":gpa>=2.5?"Khá":gpa>=2.0?"Trung bình":"Yếu";
            document.getElementById('gpa-display').innerText = gpa;
            document.getElementById('rank-display').innerText = rank;
        }
    </script>
</body>
</html>


